<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数据洞察</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .stat-card { transition: transform 0.2s ease; }
        .stat-card:hover { transform: translateY(-2px); }
    </style>
</head>
<body class="bg-gray-50">
    <section class="p-6 space-y-6 max-w-7xl mx-auto">
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5">
            <div>
                <h1 class="text-2xl font-semibold text-gray-800">数据洞察</h1>
                <p class="text-sm text-gray-500">标书制作进度分析、工具使用统计、质量评审洞察。</p>
            </div>
        </div>

        <!-- 核心数据概览 -->
        <div class="grid lg:grid-cols-2 gap-4">
            <div class="stat-card bg-white rounded-2xl shadow-sm border border-gray-100 p-5">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm text-gray-500">进行中的标书</span>
                    <i class="fas fa-file-alt text-blue-500"></i>
                </div>
                <p class="text-3xl font-bold text-gray-800" id="activeBids">24</p>
                <p class="text-xs text-gray-400 mt-1">来自标书工厂</p>
            </div>
            <div class="stat-card bg-white rounded-2xl shadow-sm border border-gray-100 p-5">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm text-gray-500">待处理评审问题</span>
                    <i class="fas fa-exclamation-triangle text-red-500"></i>
                </div>
                <p class="text-3xl font-bold text-gray-800" id="reviewIssues">12</p>
                <p class="text-xs text-gray-400 mt-1">需优先处理</p>
            </div>
        </div>

        <!-- 评审问题分析 -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-semibold text-gray-800">评审问题分析</h2>
                <span class="text-xs text-gray-400">数据来源：标书评审功能</span>
            </div>
            <div class="grid md:grid-cols-3 gap-4 mb-4">
                <div class="p-4 bg-red-50 rounded-lg border border-red-200">
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-700">高风险问题</span>
                        <span class="text-2xl font-bold text-red-600" id="highRiskCount">3</span>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">需立即处理</p>
                </div>
                <div class="p-4 bg-orange-50 rounded-lg border border-orange-200">
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-700">中风险问题</span>
                        <span class="text-2xl font-bold text-orange-600" id="mediumRiskCount">5</span>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">建议尽快处理</p>
                </div>
                <div class="p-4 bg-green-50 rounded-lg border border-green-200">
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-700">低风险问题</span>
                        <span class="text-2xl font-bold text-green-600" id="lowRiskCount">4</span>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">可后续优化</p>
                </div>
            </div>
            <div class="space-y-2" id="reviewAnalysis">
                <!-- 评审问题将通过JavaScript动态生成 -->
            </div>
        </div>

        <!-- 当前标书项目 -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-semibold text-gray-800">当前标书项目</h2>
                <span class="text-xs text-gray-400">数据来源：标书工厂</span>
            </div>
            <div class="grid md:grid-cols-3 gap-4" id="currentProjects">
                <!-- 项目卡片将通过JavaScript动态生成 -->
            </div>
        </div>
    </section>

    <script>
        // 从标书工厂页面获取的数据
        const bidFactoryData = {
            activeBids: 24,
            projects: [
                {
                    name: '智慧城市平台建设',
                    step: 1,
                    progress: 85,
                    status: '招标解读',
                    detail: '评分项分析 85%',
                    aiSuggestions: 3,
                    color: 'blue'
                },
                {
                    name: '市政道路工程投标',
                    step: 3,
                    progress: 50,
                    status: '标书编写',
                    detail: '章节 4/8 完成',
                    pendingChapters: 4,
                    color: 'purple'
                },
                {
                    name: '医疗信息化运维项目',
                    step: 2,
                    progress: 45,
                    status: '标书设置',
                    detail: '目录结构待完善',
                    missingInfo: 1,
                    color: 'orange'
                }
            ],
            processRadar: {
                interpret: 85,
                setup: 45,
                write: 62
            }
        };

        // 从智能工具箱获取的数据
        const toolboxData = {
            aiChat: { count: 156, description: '对话轮次' },
            review: { issues: 12, highRisk: 3, mediumRisk: 5, lowRisk: 4 },
            table: { count: 28, description: '生成表格数' },
            image: { count: 42, description: '生成图片数' }
        };

        // 初始化页面数据
        function initData() {
            // 显示核心数据
            document.getElementById('activeBids').textContent = bidFactoryData.activeBids;
            document.getElementById('reviewIssues').textContent = toolboxData.review.issues;

            // 显示评审问题统计
            document.getElementById('highRiskCount').textContent = toolboxData.review.highRisk;
            document.getElementById('mediumRiskCount').textContent = toolboxData.review.mediumRisk;
            document.getElementById('lowRiskCount').textContent = toolboxData.review.lowRisk;

            // 生成当前项目卡片
            renderCurrentProjects();
            
            // 生成评审问题分析
            renderReviewAnalysis();
        }

        function renderCurrentProjects() {
            const container = document.getElementById('currentProjects');
            const issueCounts = { 0: 2, 1: 5, 2: 3 }; // 对应项目的待处理问题数
            
            container.innerHTML = bidFactoryData.projects.map((project, index) => {
                const colorClasses = {
                    blue: 'bg-blue-50 border-blue-200 text-blue-600',
                    purple: 'bg-purple-50 border-purple-200 text-purple-600',
                    orange: 'bg-orange-50 border-orange-200 text-orange-600'
                };
                const issues = issueCounts[index];
                
                return `
                    <div class="border-2 ${colorClasses[project.color]} rounded-xl p-4">
                        <div class="flex items-center justify-between mb-3">
                            <p class="font-semibold text-gray-800">${project.name}</p>
                            ${issues > 0 ? `<span class="px-2 py-1 bg-red-100 text-red-600 rounded text-xs font-medium">${issues} 个问题</span>` : ''}
                        </div>
                        <p class="text-sm text-gray-600 mb-3">${project.status} · 进度 ${project.progress}%</p>
                        <div class="space-y-1 text-xs text-gray-500">
                            ${project.aiSuggestions ? `<div class="flex items-center gap-2"><i class="fas fa-lightbulb text-blue-500"></i><span>AI建议 ${project.aiSuggestions} 条</span></div>` : ''}
                            ${project.pendingChapters ? `<div class="flex items-center gap-2"><i class="fas fa-edit text-orange-500"></i><span>待编写 ${project.pendingChapters} 个章节</span></div>` : ''}
                            ${project.missingInfo ? `<div class="flex items-center gap-2"><i class="fas fa-exclamation-triangle text-red-500"></i><span>缺少信息 ${project.missingInfo} 项</span></div>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderReviewAnalysis() {
            const container = document.getElementById('reviewAnalysis');
            const issues = [
                { type: '格式规范', count: 5, risk: 'high', icon: 'fas fa-exclamation-triangle' },
                { type: '内容缺失', count: 3, risk: 'medium', icon: 'fas fa-file-alt' },
                { type: '编号规范', count: 4, risk: 'low', icon: 'fas fa-list-ol' }
            ];
            
            container.innerHTML = issues.map(issue => {
                const riskColors = {
                    high: 'text-red-600 bg-red-50 border-red-200',
                    medium: 'text-orange-600 bg-orange-50 border-orange-200',
                    low: 'text-green-600 bg-green-50 border-green-200'
                };
                return `
                    <div class="flex items-center justify-between p-3 border ${riskColors[issue.risk].split(' ')[2]} rounded-lg bg-white">
                        <div class="flex items-center gap-3">
                            <i class="${issue.icon} ${riskColors[issue.risk]} w-8 h-8 rounded-lg flex items-center justify-center"></i>
                            <div>
                                <p class="font-medium text-gray-800">${issue.type}</p>
                                <p class="text-xs text-gray-500">${issue.count} 个问题</p>
                            </div>
                        </div>
                        <span class="text-sm font-semibold ${riskColors[issue.risk].split(' ')[0]}">${issue.count}</span>
                    </div>
                `;
            }).join('');
        }

        // 页面加载时初始化数据
        window.addEventListener('load', initData);
    </script>
</body>
</html>
