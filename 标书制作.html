<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>标书制作</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .step-tab.active {
            background: #eff6ff;
            color: #1d4ed8;
            border-left: 3px solid #2563eb;
        }
        .step-content {
            display: none;
        }
        .step-content.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="flex h-screen overflow-hidden relative">
        <!-- 左侧标书流程导航 -->
        <aside id="sidebar" class="w-64 bg-white border-r border-gray-200 flex flex-col transition-all duration-300 flex-shrink-0">
            <div class="px-6 pt-4 pb-2">
                <div class="flex items-center justify-between mb-4">
                    <button onclick="goBack()" class="flex-1 px-3 py-2 text-sm text-gray-600 hover:bg-gray-50 rounded-lg flex items-center gap-2 transition">
                        <i class="fas fa-arrow-left"></i>
                        <span class="sidebar-text">返回标书工厂</span>
                    </button>
                    <button onclick="toggleSidebar()" class="ml-2 px-2 py-2 text-gray-400 hover:text-gray-600 transition" id="sidebarToggleBtn" title="收起目录">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                </div>
                <div class="text-xs font-semibold text-gray-400 tracking-wider mb-4 sidebar-text">标书流程</div>
            </div>
            <nav class="flex-1 overflow-y-auto px-3">
                <button class="step-tab active w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 text-sm mb-1" data-step="step1" onclick="switchStep('step1', event)">
                    <span class="w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xs font-semibold">1</span>
                    <span class="sidebar-text">招标解读</span>
                </button>
                <button class="step-tab w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 text-sm mb-1" data-step="step2" onclick="switchStep('step2', event)">
                    <span class="w-6 h-6 rounded-full bg-gray-100 text-gray-500 flex items-center justify-center text-xs font-semibold">2</span>
                    <span class="sidebar-text">标书设置</span>
                </button>
                <button class="step-tab w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 text-sm mb-1" data-step="step3" onclick="switchStep('step3', event)">
                    <span class="w-6 h-6 rounded-full bg-gray-100 text-gray-500 flex items-center justify-center text-xs font-semibold">3</span>
                    <span class="sidebar-text">标书编写</span>
                </button>
            </nav>
        </aside>
        
        <!-- 收起时的展开按钮 -->
        <button id="sidebarExpandBtn" onclick="toggleSidebar()" class="hidden fixed left-0 top-1/2 -translate-y-1/2 z-20 bg-white border border-gray-200 rounded-r-lg px-2 py-4 shadow-lg hover:bg-gray-50 transition" title="展开目录">
            <i class="fas fa-chevron-right text-gray-600"></i>
        </button>

        <!-- 右侧内容区域 -->
        <main class="flex-1 overflow-y-auto">
            <!-- 招标解读内容 -->
            <div id="step1" class="step-content active">
                <iframe src="招标解读.html" class="w-full h-full border-0" style="min-height: 100vh;"></iframe>
            </div>

            <!-- 标书设置内容 -->
            <div id="step2" class="step-content">
                <iframe src="标书设置.html" class="w-full h-full border-0" style="min-height: 100vh;"></iframe>
            </div>

            <!-- 标书编写内容 -->
            <div id="step3" class="step-content">
                <iframe src="标书编写.html" class="w-full h-full border-0" style="min-height: 100vh;"></iframe>
            </div>
        </main>
    </div>

    <script>
        // 左侧目录栏收起/展开
        let sidebarCollapsed = false;
        
        function toggleSidebar() {
            sidebarCollapsed = !sidebarCollapsed;
            const sidebar = document.getElementById('sidebar');
            const toggleBtn = document.getElementById('sidebarToggleBtn');
            const expandBtn = document.getElementById('sidebarExpandBtn');
            
            if (sidebarCollapsed) {
                // 收起：完全隐藏
                sidebar.style.width = '0';
                sidebar.style.minWidth = '0';
                sidebar.style.opacity = '0';
                sidebar.style.overflow = 'hidden';
                sidebar.style.padding = '0';
                sidebar.style.margin = '0';
                toggleBtn.style.display = 'none';
                expandBtn.classList.remove('hidden');
            } else {
                // 展开：恢复宽度
                sidebar.style.width = '256px';
                sidebar.style.minWidth = '256px';
                sidebar.style.opacity = '1';
                sidebar.style.overflow = 'visible';
                sidebar.style.padding = '';
                sidebar.style.margin = '';
                toggleBtn.style.display = 'block';
                toggleBtn.querySelector('i').classList.remove('fa-chevron-right');
                toggleBtn.querySelector('i').classList.add('fa-chevron-left');
                toggleBtn.title = '收起目录';
                expandBtn.classList.add('hidden');
            }
            
            // 保存状态到localStorage
            localStorage.setItem('sidebarCollapsed', sidebarCollapsed);
        }
        
        // 页面加载时恢复侧边栏状态
        window.addEventListener('load', function() {
            const saved = localStorage.getItem('sidebarCollapsed');
            if (saved === 'true') {
                sidebarCollapsed = true;
                const sidebar = document.getElementById('sidebar');
                const toggleBtn = document.getElementById('sidebarToggleBtn');
                const expandBtn = document.getElementById('sidebarExpandBtn');
                
                // 直接应用收起状态
                sidebar.style.width = '0';
                sidebar.style.minWidth = '0';
                sidebar.style.opacity = '0';
                sidebar.style.overflow = 'hidden';
                sidebar.style.padding = '0';
                sidebar.style.margin = '0';
                toggleBtn.style.display = 'none';
                expandBtn.classList.remove('hidden');
            }
        });
        
        function goBack() {
            try {
                if (window.parent && window.parent.loadPage) {
                    window.parent.loadPage('标书工厂.html', 'top');
                } else {
                    window.location.href = '标书工厂.html';
                }
            } catch (e) {
                console.error('返回失败:', e);
                window.location.href = '标书工厂.html';
            }
        }
        
        function switchStep(stepId, event) {
            // 更新页签状态 - 先移除所有active状态
            const allTabs = document.querySelectorAll('.step-tab');
            allTabs.forEach(tab => {
                tab.classList.remove('active');
                const num = tab.querySelector('span span');
                if (num) {
                    num.className = 'w-6 h-6 rounded-full bg-gray-100 text-gray-500 flex items-center justify-center text-xs font-semibold';
                }
            });
            
            // 根据stepId找到对应的tab
            let activeTab = null;
            
            // 如果通过事件调用，优先使用事件目标
            if (event && event.target) {
                const clickedTab = event.target.closest('.step-tab');
                if (clickedTab) {
                    activeTab = clickedTab;
                }
            }
            
            // 如果没有通过事件找到，使用data-step属性查找（最可靠的方法）
            if (!activeTab) {
                activeTab = document.querySelector(`.step-tab[data-step="${stepId}"]`);
            }
            
            // 如果还是没找到，使用备用方法
            if (!activeTab) {
                const tabs = document.querySelectorAll('.step-tab');
                if (stepId === 'step1' && tabs.length > 0) {
                    activeTab = tabs[0];
                } else if (stepId === 'step2' && tabs.length > 1) {
                    activeTab = tabs[1];
                } else if (stepId === 'step3' && tabs.length > 2) {
                    activeTab = tabs[2];
                }
            }
            
            // 激活对应的tab
            if (activeTab) {
                activeTab.classList.add('active');
                const activeNum = activeTab.querySelector('span span');
                if (activeNum) {
                    activeNum.className = 'w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xs font-semibold';
                }
            }

            // 更新内容显示
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.remove('active');
            });
            const targetContent = document.getElementById(stepId);
            if (targetContent) {
                targetContent.classList.add('active');
            }
        }
        
        // 将switchStep暴露到window，以便iframe可以调用
        window.switchStep = switchStep;
        
        // 确保在页面加载完成后，switchStep函数可用
        document.addEventListener('DOMContentLoaded', function() {
            window.switchStep = switchStep;
        });
    </script>
</body>
</html>

