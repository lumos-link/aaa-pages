<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>招标解读</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50">
    <section class="p-6 space-y-6">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
            <div>
                <p class="text-xs text-blue-500 font-semibold uppercase tracking-widest mb-2">Step 01</p>
                <h1 class="text-2xl font-semibold text-gray-800">招标文件解读</h1>
                <p class="text-sm text-gray-500">支持 doc / pdf / xls，多文件合并解析，自动拆出评分、暗标与格式要求。</p>
            </div>
        </div>

        <div class="grid lg:grid-cols-2 gap-6">
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 space-y-4">
                <div class="flex items-center justify-between">
                    <h2 class="text-lg font-semibold text-gray-800">招标文件</h2>
                    <span class="text-xs text-gray-400">最大 40MB</span>
                </div>
                <div id="uploadArea" class="border-2 border-dashed border-gray-200 rounded-xl p-6 text-center text-sm text-gray-600 cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition" 
                     onclick="document.getElementById('fileInput').click()"
                     ondrop="handleFileDrop(event)"
                     ondragover="handleDragOver(event)"
                     ondragleave="handleDragLeave(event)">
                    <input type="file" id="fileInput" multiple accept=".doc,.docx,.pdf,.xls,.xlsx" class="hidden" onchange="handleFileSelect(event)">
                    <i class="fas fa-file-import text-3xl text-blue-500 mb-3"></i>
                    <p class="font-semibold text-gray-700 mb-1">拖拽或点击上传</p>
                    <p class="text-xs text-gray-400">支持 doc、docx、pdf、xls、xlsx（不含扫描件）</p>
                </div>
                <div id="fileList" class="space-y-3 text-sm">
                    <!-- 文件列表将动态生成 -->
                </div>
                <div id="startParseSection" class="pt-2 border-t border-gray-100">
                    <button id="startParseBtn" onclick="startParseAll()" class="w-full px-4 py-2.5 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        <i class="fas fa-magic"></i>
                        <span>开始生成解析摘要</span>
                    </button>
                    <p class="text-xs text-gray-400 text-center mt-2">上传文件后，点击按钮开始解析所有文件</p>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 space-y-4">
                <div class="flex items-center justify-between">
                    <div>
                    <h2 class="text-lg font-semibold text-gray-800">AI 解析摘要</h2>
                        <p id="currentPackageLabel" class="mt-1 text-xs text-gray-400">当前包：包一 · 平台建设</p>
                    </div>
                    <span class="text-xs text-gray-400">自动生成</span>
                </div>

                <!-- 项目元信息（更靠近解析结果展示） -->
                <div class="mt-2 p-3 bg-gray-50 border border-gray-100 rounded-xl">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-xs font-semibold text-gray-700">项目基本信息</h3>
                        <button onclick="editProjectInfo()" class="text-[11px] text-blue-600 hover:text-blue-700" id="editProjectBtn">
                            <i class="fas fa-edit mr-1"></i>编辑
                        </button>
                    </div>
                    <div id="projectInfoView" class="grid md:grid-cols-3 gap-2 text-[11px] text-gray-700">
                        <div><span class="text-gray-500">类型：</span><span id="projectType">研发</span></div>
                        <div class="md:col-span-2"><span class="text-gray-500">名称：</span><span id="projectName">城市运行数字底座建设项目</span></div>
                        <div><span class="text-gray-500">招标人：</span><span id="tenderer">XX市大数据局</span></div>
                        <div><span class="text-gray-500">代理机构：</span><span id="agency">XX招标代理公司</span></div>
                        <div><span class="text-gray-500">开标：</span><span id="bidDate">2025-03-15 09:00</span></div>
                        <div><span class="text-gray-500">有效期：</span><span id="validPeriod">90天</span></div>
                    </div>
                    <div id="projectInfoEdit" class="hidden mt-3 space-y-2">
                        <div class="grid md:grid-cols-2 gap-2">
                            <div>
                                <label class="block text-[11px] text-gray-600 mb-1">项目类型 <span class="text-red-500">*</span></label>
                                <select id="editProjectType" class="w-full px-2 py-1.5 border border-gray-300 rounded-lg text-xs focus:ring-2 focus:ring-blue-500">
                                    <option value="研发">研发</option>
                                    <option value="维护">维护</option>
                                    <option value="集成">集成</option>
                                    <option value="合作伙伴入围">合作伙伴入围</option>
                                    <option value="其他">其他</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-[11px] text-gray-600 mb-1">项目名称 <span class="text-red-500">*</span></label>
                                <input type="text" id="editProjectName" class="w-full px-2 py-1.5 border border-gray-300 rounded-lg text-xs focus:ring-2 focus:ring-blue-500" placeholder="请输入项目名称">
                            </div>
                            <div>
                                <label class="block text-[11px] text-gray-600 mb-1">招标人 <span class="text-red-500">*</span></label>
                                <input type="text" id="editTenderer" class="w-full px-2 py-1.5 border border-gray-300 rounded-lg text-xs focus:ring-2 focus:ring-blue-500" placeholder="请输入招标人名称">
                            </div>
                            <div>
                                <label class="block text-[11px] text-gray-600 mb-1">代理机构</label>
                                <input type="text" id="editAgency" class="w-full px-2 py-1.5 border border-gray-300 rounded-lg text-xs focus:ring-2 focus:ring-blue-500" placeholder="请输入代理机构名称">
                            </div>
                            <div>
                                <label class="block text-[11px] text-gray-600 mb-1">开标日期 <span class="text-red-500">*</span></label>
                                <input type="datetime-local" id="editBidDate" class="w-full px-2 py-1.5 border border-gray-300 rounded-lg text-xs focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-[11px] text-gray-600 mb-1">投标有效期 <span class="text-red-500">*</span></label>
                                <div class="flex gap-1">
                                    <input type="number" id="editValidPeriod" class="flex-1 px-2 py-1.5 border border-gray-300 rounded-lg text-xs focus:ring-2 focus:ring-blue-500" placeholder="天数" min="1">
                                    <span class="self-center text-[11px] text-gray-500">天</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-2 mt-2">
                            <button onclick="saveProjectInfo()" class="px-3 py-1.5 bg-blue-600 text-white rounded-lg text-xs hover:bg-blue-700">
                                <i class="fas fa-save mr-1"></i>保存
                            </button>
                            <button onclick="cancelEditProjectInfo()" class="px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg text-xs hover:bg-gray-200">
                                取消
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 包级页签：根据解析出的包动态生成，这里用示例数据展示 -->
                <div class="mt-3 border-b border-gray-100 pb-2">
                    <div class="flex gap-2 overflow-x-auto text-xs">
                        <button class="pkg-tab active px-3 py-1.5 rounded-full bg-blue-50 text-blue-600 font-medium whitespace-nowrap" data-pkg="pkg1">包一 · 平台建设</button>
                        <button class="pkg-tab px-3 py-1.5 rounded-full bg-gray-50 text-gray-500 whitespace-nowrap" data-pkg="pkg2">包二 · 运维服务</button>
                        <button class="pkg-tab px-3 py-1.5 rounded-full bg-gray-50 text-gray-500 whitespace-nowrap" data-pkg="pkg3">包三 · 备选方案</button>
                    </div>
                </div>

                <div class="border-b border-gray-200 mt-2">
                    <div class="flex gap-2 overflow-x-auto pb-2" id="tabButtonsContainer">
                        <button class="tab-btn active px-4 py-2 text-sm font-medium text-blue-600 border-b-2 border-blue-600 whitespace-nowrap" data-tab="overview">项目概述</button>
                        <button class="tab-btn px-4 py-2 text-sm font-medium text-gray-500 whitespace-nowrap" data-tab="rejection">废标项</button>
                        <button class="tab-btn px-4 py-2 text-sm font-medium text-gray-500 whitespace-nowrap" data-tab="personnel">人员要求</button>
                        <button class="tab-btn px-4 py-2 text-sm font-medium text-gray-500 whitespace-nowrap" data-tab="performance">业绩要求</button>
                        <button class="tab-btn px-4 py-2 text-sm font-medium text-gray-500 whitespace-nowrap" data-tab="qualification">资质要求</button>
                        <button class="tab-btn px-4 py-2 text-sm font-medium text-gray-500 whitespace-nowrap" data-tab="commitment">承诺书要求</button>
                        <button class="tab-btn px-4 py-2 text-sm font-medium text-gray-500 whitespace-nowrap" data-tab="p2p">点对点应答</button>
                        <button class="tab-btn px-4 py-2 text-sm font-medium text-gray-500 whitespace-nowrap" data-tab="score">评分要求</button>
                        <button class="tab-btn px-4 py-2 text-sm font-medium text-gray-500 whitespace-nowrap" data-tab="hidden">暗标要求</button>
                        <button class="tab-btn px-4 py-2 text-sm font-medium text-gray-500 whitespace-nowrap" data-tab="format">响应文件格式</button>
                    </div>
                </div>
                <div class="tab-content" id="tab-overview">
                    <div class="p-4 rounded-xl bg-blue-50 border border-blue-100 text-sm text-gray-700">
                        <p class="font-semibold text-gray-800 mb-2">项目基本信息</p>
                        <p class="mb-3">建设"城市运行数字底座"，包含感知、平台、应用三层架构，合同期 24 个月。</p>
                        <p class="font-semibold text-gray-800 mb-2">项目目标</p>
                        <p>实现城市运行数据的实时采集、分析和展示，为城市管理者提供科学决策支持。</p>
                    </div>
                </div>
                <div class="tab-content hidden" id="tab-rejection">
                    <div class="p-4 rounded-xl bg-red-50 border-2 border-red-200 text-sm text-gray-700">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-exclamation-triangle text-red-600"></i>
                                <p class="font-semibold text-red-800">废标条件（必须严格遵守）</p>
                            </div>
                        </div>
                        <div id="rejectionItemsList" class="space-y-3">
                            <!-- 结构化废标项列表，将动态生成 -->
                            <div class="rejection-item p-3 bg-white rounded-lg border-l-4 border-red-500" data-type="substantial" data-symbol="★">
                                <div class="flex items-start">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-1">
                                            <span class="text-red-600 font-bold">★</span>
                                            <span class="px-2 py-0.5 bg-red-100 text-red-700 rounded text-xs font-medium">实质项</span>
                                            <span class="text-xs text-gray-500">第3章 第5条</span>
                                        </div>
                                        <p class="font-semibold text-gray-800 mb-1">投标文件未按要求签字盖章</p>
                                        <p class="text-xs text-gray-600">投标函、法定代表人身份证明等文件必须加盖公章并由法定代表人签字</p>
                                    </div>
                                </div>
                            </div>
                            <div class="rejection-item p-3 bg-white rounded-lg border-l-4 border-red-500" data-type="substantial" data-symbol="※">
                                <div class="flex items-start">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-1">
                                            <span class="text-red-600 font-bold">※</span>
                                            <span class="px-2 py-0.5 bg-red-100 text-red-700 rounded text-xs font-medium">实质项</span>
                                            <span class="text-xs text-gray-500">第2章 第3条</span>
                                        </div>
                                        <p class="font-semibold text-gray-800 mb-1">投标报价超过最高限价</p>
                                        <p class="text-xs text-gray-600">项目最高限价为 500 万元，超过此价格将直接废标</p>
                                    </div>
                                </div>
                            </div>
                            <div class="rejection-item p-3 bg-white rounded-lg border-l-4 border-orange-500" data-type="non-deviating" data-symbol="▲">
                                <div class="flex items-start">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-1">
                                            <span class="text-orange-600 font-bold">▲</span>
                                            <span class="px-2 py-0.5 bg-orange-100 text-orange-700 rounded text-xs font-medium">不可偏离项</span>
                                            <span class="text-xs text-gray-500">第4章 第2条</span>
                                        </div>
                                        <p class="font-semibold text-gray-800 mb-1">未提供有效的企业资质证书</p>
                                        <p class="text-xs text-gray-600">必须提供有效期内的营业执照、相关行业资质证书等</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-red-100 rounded-lg border border-red-200">
                            <p class="text-xs text-red-800 font-semibold"><i class="fas fa-info-circle mr-1"></i>提示：以上任何一项不符合要求，将直接导致投标被拒绝，请务必仔细检查</p>
                        </div>
                    </div>
                </div>
                <!-- 人员要求 -->
                <div class="tab-content hidden" id="tab-personnel">
                    <div class="p-4 rounded-xl bg-blue-50 border border-blue-100 text-sm text-gray-700">
                        <div class="flex items-center justify-between mb-3">
                            <p class="font-semibold text-gray-800">人员要求</p>
                        </div>
                        <div id="personnelRequirementsList" class="space-y-3">
                            <div class="personnel-item p-3 bg-white rounded-lg border border-blue-200">
                                <div class="flex items-start justify-between mb-2">
                                    <div class="flex-1">
                                        <p class="font-semibold text-gray-800 mb-1">项目团队人员配置</p>
                                        <div class="grid grid-cols-2 gap-2 text-xs text-gray-600">
                                            <div><span class="font-medium">总人数：</span>不少于 8 人</div>
                                            <div><span class="font-medium">驻场人员：</span>不少于 3 人</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-2 p-2 bg-gray-50 rounded text-xs">
                                    <p class="font-medium text-gray-700 mb-1">角色要求：</p>
                                    <ul class="space-y-1 text-gray-600">
                                        <li>• 项目经理 1 名（需PMP资质）</li>
                                        <li>• 技术负责人 1 名（需高级职称）</li>
                                        <li>• 开发工程师 4 名</li>
                                        <li>• 测试工程师 2 名</li>
                                    </ul>
                                </div>
                                <div class="mt-2 p-2 bg-gray-50 rounded text-xs">
                                    <p class="font-medium text-gray-700 mb-1">证明材料：</p>
                                    <div class="flex flex-wrap gap-1">
                                        <span class="px-2 py-0.5 bg-blue-100 text-blue-700 rounded">身份证</span>
                                        <span class="px-2 py-0.5 bg-blue-100 text-blue-700 rounded">学历证书</span>
                                        <span class="px-2 py-0.5 bg-blue-100 text-blue-700 rounded">学信网证明</span>
                                        <span class="px-2 py-0.5 bg-blue-100 text-blue-700 rounded">PMP证书</span>
                                        <span class="px-2 py-0.5 bg-blue-100 text-blue-700 rounded">社保缴纳证明（近6个月）</span>
                                        <span class="px-2 py-0.5 bg-blue-100 text-blue-700 rounded">劳动合同</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 业绩要求 -->
                <div class="tab-content hidden" id="tab-performance">
                    <div class="p-4 rounded-xl bg-green-50 border border-green-100 text-sm text-gray-700">
                        <div class="flex items-center justify-between mb-3">
                            <p class="font-semibold text-gray-800">业绩要求</p>
                        </div>
                        <div id="performanceRequirementsList" class="space-y-3">
                            <div class="performance-item p-3 bg-white rounded-lg border border-green-200">
                                <div class="flex items-start justify-between mb-2">
                                    <div class="flex-1">
                                        <p class="font-semibold text-gray-800 mb-1">同类项目业绩</p>
                                        <div class="grid grid-cols-2 gap-2 text-xs text-gray-600">
                                            <div><span class="font-medium">时间范围：</span>近3年（2022年1月1日至今）</div>
                                            <div><span class="font-medium">关键词：</span>智慧城市、数字底座、数据治理</div>
                                            <div><span class="font-medium">数量要求：</span>不少于 3 个</div>
                                            <div><span class="font-medium">金额要求：</span>单个项目金额 ≥ 300 万元</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-2 p-2 bg-gray-50 rounded text-xs">
                                    <p class="font-medium text-gray-700 mb-1">需提供的证明材料：</p>
                                    <div class="flex flex-wrap gap-1">
                                        <span class="px-2 py-0.5 bg-green-100 text-green-700 rounded">合同首页</span>
                                        <span class="px-2 py-0.5 bg-green-100 text-green-700 rounded">合同金额页</span>
                                        <span class="px-2 py-0.5 bg-green-100 text-green-700 rounded">服务内容页</span>
                                        <span class="px-2 py-0.5 bg-green-100 text-green-700 rounded">签字盖章页</span>
                                        <span class="px-2 py-0.5 bg-green-100 text-green-700 rounded">发票</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 资质要求 -->
                <div class="tab-content hidden" id="tab-qualification">
                    <div class="p-4 rounded-xl bg-yellow-50 border border-yellow-100 text-sm text-gray-700">
                        <div class="flex items-center justify-between mb-3">
                            <p class="font-semibold text-gray-800">资质要求</p>
                        </div>
                        <div id="qualificationRequirementsList" class="space-y-3">
                            <div class="qualification-item p-3 bg-white rounded-lg border border-yellow-200">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-1">
                                            <i class="fas fa-certificate text-yellow-600"></i>
                                            <p class="font-semibold text-gray-800">CMMI5 认证</p>
                                        </div>
                                        <p class="text-xs text-gray-600">需提供有效期内的CMMI5级认证证书</p>
                                    </div>
                                </div>
                            </div>
                            <div class="qualification-item p-3 bg-white rounded-lg border border-yellow-200">
                                <div class="flex items-start">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-1">
                                            <i class="fas fa-certificate text-yellow-600"></i>
                                            <p class="font-semibold text-gray-800">ISO 9001 质量管理体系认证</p>
                                        </div>
                                        <p class="text-xs text-gray-600">需提供有效期内的ISO 9001认证证书</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 承诺书要求 -->
                <div class="tab-content hidden" id="tab-commitment">
                    <div class="p-4 rounded-xl bg-purple-50 border border-purple-100 text-sm text-gray-700">
                        <div class="flex items-center justify-between mb-3">
                            <p class="font-semibold text-gray-800">承诺书要求</p>
                        </div>
                        <div id="commitmentRequirementsList" class="space-y-3">
                            <div class="commitment-item p-3 bg-white rounded-lg border border-purple-200">
                                <div class="flex items-start">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-1">
                                            <i class="fas fa-file-signature text-purple-600"></i>
                                            <p class="font-semibold text-gray-800">项目上线运行承诺</p>
                                        </div>
                                        <p class="text-xs text-gray-600 mb-2">承诺项目在合同签订后 30 日内上线运行</p>
                                        <div class="text-xs text-gray-500">
                                            <p><span class="font-medium">承诺形式：</span>承诺书</p>
                                            <p><span class="font-medium">时间约束：</span>30日内</p>
                                            <p><span class="font-medium">模板：</span>标准承诺书模板</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 点对点应答要求 -->
                <div class="tab-content hidden" id="tab-p2p">
                    <div class="p-4 rounded-xl bg-teal-50 border border-teal-100 text-sm text-gray-700">
                        <div class="flex items-center justify-between mb-3">
                            <p class="font-semibold text-gray-800">点对点应答要求</p>
                            <span class="text-xs text-gray-500">逐条响应招标条款</span>
                        </div>
                        <p class="text-xs text-gray-600 mb-3">以下条款需要在投标文件中按表格形式逐条应答，通常以“满足/不满足/部分满足+说明”的形式填写。</p>
                        <div class="overflow-x-auto rounded-lg border border-teal-100 bg-white">
                            <table class="min-w-full text-xs text-gray-700">
                                <thead class="bg-teal-50 border-b border-teal-100">
                                    <tr>
                                        <th class="px-3 py-2 text-left font-medium text-gray-600 whitespace-nowrap">序号</th>
                                        <th class="px-3 py-2 text-left font-medium text-gray-600 whitespace-nowrap">条款编号</th>
                                        <th class="px-3 py-2 text-left font-medium text-gray-600 whitespace-nowrap">条款内容</th>
                                        <th class="px-3 py-2 text-left font-medium text-gray-600 whitespace-nowrap">应答方式</th>
                                        <th class="px-3 py-2 text-left font-medium text-gray-600 whitespace-nowrap">是否必应答</th>
                                    </tr>
                                </thead>
                                <tbody id="p2pRequirementList" class="divide-y divide-gray-100">
                                    <tr>
                                        <td class="px-3 py-2 align-top">1</td>
                                        <td class="px-3 py-2 align-top whitespace-nowrap">3.2.1</td>
                                        <td class="px-3 py-2 align-top">
                                            投标人需对《技术需求表》中列出的所有技术指标逐条应答，并在“是否满足”栏中勾选“满足/部分满足/不满足”，对“部分满足/不满足”的条款需在备注中说明原因及替代方案。
                                        </td>
                                        <td class="px-3 py-2 align-top whitespace-nowrap">表格勾选 + 文字说明</td>
                                        <td class="px-3 py-2 align-top text-red-600 font-semibold">是</td>
                                    </tr>
                                    <tr class="bg-teal-50/40">
                                        <td class="px-3 py-2 align-top">2</td>
                                        <td class="px-3 py-2 align-top whitespace-nowrap">4.1.3</td>
                                        <td class="px-3 py-2 align-top">
                                            投标人需对《商务条款应答表》中列出的所有商务条款逐条应答，明确是否“完全响应”或提出偏离说明。
                                        </td>
                                        <td class="px-3 py-2 align-top whitespace-nowrap">表格勾选 + 偏离说明</td>
                                        <td class="px-3 py-2 align-top text-red-600 font-semibold">是</td>
                                    </tr>
                                    <tr>
                                        <td class="px-3 py-2 align-top">3</td>
                                        <td class="px-3 py-2 align-top whitespace-nowrap">5.2.4</td>
                                        <td class="px-3 py-2 align-top">
                                            投标人需对服务响应时间、故障处理时限、服务覆盖范围等服务指标逐条应答，并承诺不低于本招标文件要求。
                                        </td>
                                        <td class="px-3 py-2 align-top whitespace-nowrap">表格勾选 + 承诺文本</td>
                                        <td class="px-3 py-2 align-top text-yellow-600 font-semibold">建议</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <p class="mt-3 text-xs text-gray-500">提示：系统后续可根据此结构自动生成“需求应答表”，并在标书编写阶段支持逐条填报和一键插入。</p>
                    </div>
                </div>
                <div class="tab-content hidden" id="tab-hidden">
                    <div class="p-4 rounded-xl bg-red-50 border border-red-100 text-sm text-gray-700">
                        <p class="font-semibold text-gray-800 mb-2">暗标文件要求</p>
                        <ul class="space-y-2">
                            <li class="flex items-start gap-2">
                                <i class="fas fa-ban text-red-500 mt-1"></i>
                                <span>禁止出现公司名称、logo、印章等标识信息</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <i class="fas fa-file-pdf text-red-500 mt-1"></i>
                                <span>需单独导出 PDF 格式，并设置密码保护</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <i class="fas fa-lock text-red-500 mt-1"></i>
                                <span>文件命名需按指定规则，不得包含企业信息</span>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="tab-content hidden" id="tab-score">
                    <div class="p-4 rounded-xl bg-purple-50 border border-purple-100 text-sm text-gray-700">
                        <div class="flex items-center justify-between mb-3">
                            <p class="font-semibold text-gray-800">评分标准</p>
                        </div>
                        <div id="scoreStandardList" class="space-y-3">
                            <!-- 资格评审 -->
                            <div class="score-category p-3 bg-white rounded-lg border-l-4 border-blue-500">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center gap-2">
                                        <i class="fas fa-check-circle text-blue-600"></i>
                                        <p class="font-semibold text-gray-800">资格评审</p>
                                    </div>
                                    <span class="text-xs text-gray-500">通过/不通过</span>
                                </div>
                                <div class="ml-6 space-y-1 text-xs text-gray-600">
                                    <p>• 投标人资格符合招标文件要求</p>
                                    <p>• 投标文件格式完整</p>
                                    <p>• 投标保证金已缴纳</p>
                                </div>
                            </div>
                            <!-- 初步评审 -->
                            <div class="score-category p-3 bg-white rounded-lg border-l-4 border-green-500">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center gap-2">
                                        <i class="fas fa-clipboard-check text-green-600"></i>
                                        <p class="font-semibold text-gray-800">初步评审</p>
                                    </div>
                                    <span class="text-xs text-gray-500">通过/不通过</span>
                                </div>
                                <div class="ml-6 space-y-1 text-xs text-gray-600">
                                    <p>• 投标文件实质性响应招标文件</p>
                                    <p>• 未出现废标项</p>
                                </div>
                            </div>
                            <!-- 响应性评审 -->
                            <div class="score-category p-3 bg-white rounded-lg border-l-4 border-yellow-500">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center gap-2">
                                        <i class="fas fa-list-check text-yellow-600"></i>
                                        <p class="font-semibold text-gray-800">响应性评审</p>
                                    </div>
                                    <span class="text-xs text-gray-500">通过/不通过</span>
                                </div>
                                <div class="ml-6 space-y-1 text-xs text-gray-600">
                                    <p>• 技术方案完整响应招标要求</p>
                                    <p>• 商务条款逐条响应</p>
                                </div>
                            </div>
                            <!-- 详细评审 -->
                            <div class="score-category p-3 bg-white rounded-lg border-l-4 border-purple-500">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center gap-2">
                                        <i class="fas fa-star text-purple-600"></i>
                                        <p class="font-semibold text-gray-800">详细评审</p>
                                    </div>
                                    <span class="text-xs text-gray-500">总分 100 分</span>
                                </div>
                                <div class="ml-6 space-y-2">
                                    <div class="p-2 bg-gray-50 rounded">
                                        <div class="flex items-center justify-between mb-1">
                                            <span class="font-medium text-gray-800">商务部分</span>
                                <span class="text-purple-600 font-semibold">20 分</span>
                                        </div>
                                        <div class="text-xs text-gray-600 space-y-1">
                                            <p>• 报价合理性：10分</p>
                                            <p>• 付款方式：5分</p>
                                            <p>• 售后服务：5分</p>
                                        </div>
                                    </div>
                                    <div class="p-2 bg-gray-50 rounded">
                                        <div class="flex items-center justify-between mb-1">
                                            <span class="font-medium text-gray-800">技术部分</span>
                                            <span class="text-purple-600 font-semibold">40 分</span>
                                        </div>
                                        <div class="text-xs text-gray-600 space-y-1">
                                            <p>• 技术方案：25分（需突出数据治理能力）</p>
                                            <p>• 技术架构：10分</p>
                                            <p>• 实施方案：5分</p>
                                        </div>
                                    </div>
                                    <div class="p-2 bg-gray-50 rounded">
                                        <div class="flex items-center justify-between mb-1">
                                            <span class="font-medium text-gray-800">业绩案例</span>
                                            <span class="text-purple-600 font-semibold">25 分</span>
                                        </div>
                                        <div class="text-xs text-gray-600 space-y-1">
                                            <p>• 近三年同类项目：15分（必须为近三年）</p>
                                            <p>• 项目规模：10分</p>
                                        </div>
                                    </div>
                                    <div class="p-2 bg-gray-50 rounded">
                                        <div class="flex items-center justify-between mb-1">
                                            <span class="font-medium text-gray-800">团队配置</span>
                                            <span class="text-purple-600 font-semibold">15 分</span>
                                        </div>
                                        <div class="text-xs text-gray-600 space-y-1">
                                            <p>• 项目经理资质：5分（需PMP）</p>
                                            <p>• 团队结构：5分（需提供驻场组织图）</p>
                                            <p>• 人员经验：5分</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-content hidden" id="tab-format">
                    <div class="p-4 rounded-xl bg-green-50 border border-green-100 text-sm text-gray-700">
                        <div class="flex items-center justify-between mb-3">
                            <p class="font-semibold text-gray-800">响应文件格式</p>
                        </div>
                        <div id="formatStructureList" class="space-y-2 text-xs">
                            <div class="format-item p-3 bg-white rounded-lg border border-green-200" data-required="true">
                                <div class="flex items-start justify-between">
                                <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-1">
                                            <i class="fas fa-file-alt text-green-600"></i>
                                    <p class="font-semibold text-gray-800">第一部分 投标函及投标函附录</p>
                                        </div>
                                        <div class="ml-6 space-y-1">
                                            <div class="flex items-center gap-2">
                                                <span class="text-gray-600">1.1 投标函</span>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <span class="text-gray-600">1.2 投标函附录</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="format-item p-3 bg-white rounded-lg border border-green-200" data-required="true">
                                <div class="flex items-start justify-between">
                                <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-1">
                                            <i class="fas fa-file-alt text-green-600"></i>
                                    <p class="font-semibold text-gray-800">第二部分 法定代表人身份证明</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="format-item p-3 bg-white rounded-lg border border-green-200" data-required="true">
                                <div class="flex items-start justify-between">
                                <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-1">
                                            <i class="fas fa-file-alt text-green-600"></i>
                                    <p class="font-semibold text-gray-800">第三部分 技术方案</p>
                                        </div>
                                        <div class="ml-6 space-y-1">
                                            <div class="flex items-center gap-2">
                                                <span class="text-gray-600">3.1 项目理解</span>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <span class="text-gray-600">3.2 技术架构</span>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <span class="text-gray-600">3.3 实施方案</span>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <span class="text-gray-600">3.4 质量保证措施</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="format-item p-3 bg-white rounded-lg border border-green-200" data-required="true">
                                <div class="flex items-start justify-between">
                                <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-1">
                                            <i class="fas fa-file-alt text-green-600"></i>
                                    <p class="font-semibold text-gray-800">第四部分 商务部分</p>
                                        </div>
                                        <div class="ml-6 space-y-1">
                                            <div class="flex items-center gap-2">
                                                <span class="text-gray-600">4.1 报价明细</span>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <span class="text-gray-600">4.2 付款方式</span>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <span class="text-gray-600">4.3 售后服务</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="format-item p-3 bg-white rounded-lg border border-green-200" data-required="true">
                                <div class="flex items-start justify-between">
                                <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-1">
                                            <i class="fas fa-file-alt text-green-600"></i>
                                    <p class="font-semibold text-gray-800">第五部分 资格证明文件</p>
                                        </div>
                                        <div class="ml-6 space-y-1">
                                            <div class="flex items-center gap-2">
                                                <span class="text-gray-600">5.1 企业资质</span>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <span class="text-gray-600">5.2 业绩案例</span>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <span class="text-gray-600">5.3 团队配置</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <p class="mt-3 text-xs text-gray-500 italic">此目录结构将作为标书默认目录，可在标书设置中修改。</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-sm border border-blue-100 p-5 flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
            <div>
                <p class="text-sm font-semibold text-gray-800">解析完成</p>
                <p class="text-xs text-gray-500 mt-1">AI已解析招标文件，请进入标书设置配置项目信息。</p>
            </div>
            <div class="flex flex-wrap gap-3 text-sm">
                <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition" onclick="goToNextStep('标书设置.html')">
                    <i class="fas fa-arrow-right mr-2"></i> 下一步：标书设置
                </button>
            </div>
        </div>

    </section>
    <script>
        // 存储键名
        const STORAGE_INTERPRET_KEY = 'bidding_interpret_data';
        
        // 初始化项目信息
        let projectInfo = {
            projectType: '研发',
            projectName: '城市运行数字底座建设项目',
            tenderer: 'XX市大数据局',
            agency: 'XX招标代理公司',
            bidDate: '2025-03-15T09:00',
            validPeriod: 90
        };
        
        // 文件列表管理
        let uploadedFiles = [];
        let isParsing = false;
        let parseCompleted = false;
        
        // 页签切换函数（直接在HTML中调用）- 必须在最前面定义，确保全局可访问
        function switchTab(tabId, buttonElement) {
            try {
                if (!tabId || !buttonElement) {
                    console.warn('页签切换参数错误', tabId, buttonElement);
                    return false;
                }
                
                console.log('切换页签:', tabId);
                
                // 更新按钮样式
                const allButtons = document.querySelectorAll('.tab-btn');
                allButtons.forEach(b => {
                    b.classList.remove('active', 'text-blue-600', 'border-b-2', 'border-blue-600');
                    b.classList.add('text-gray-500');
                });
                buttonElement.classList.add('active', 'text-blue-600', 'border-b-2', 'border-blue-600');
                buttonElement.classList.remove('text-gray-500');
                
                // 更新内容显示
                const allContents = document.querySelectorAll('.tab-content');
                allContents.forEach(content => {
                    content.classList.add('hidden');
                });
                const targetTab = document.getElementById('tab-' + tabId);
                if (targetTab) {
                    targetTab.classList.remove('hidden');
                    console.log('页签内容已显示:', 'tab-' + tabId);
                } else {
                    console.warn('找不到页签内容:', 'tab-' + tabId);
                }
                
                return false;
            } catch (e) {
                console.error('页签切换错误:', e);
                return false;
            }
        }
        
        // 确保函数在全局作用域中可用
        window.switchTab = switchTab;
        
        // 初始化页签切换功能 - 使用事件委托
        function initTabSwitching() {
            const container = document.getElementById('tabButtonsContainer');
            if (!container) {
                console.warn('找不到页签容器');
                setTimeout(initTabSwitching, 100);
                return;
            }
            
            // 移除旧的事件监听器
            const newContainer = container.cloneNode(true);
            container.parentNode.replaceChild(newContainer, container);
            
            // 使用事件委托
            newContainer.addEventListener('click', function(e) {
                const btn = e.target.closest('.tab-btn');
                if (!btn) return;
                
                e.preventDefault();
                e.stopPropagation();
                
                const tabId = btn.getAttribute('data-tab');
                if (!tabId) {
                    console.warn('页签按钮缺少data-tab属性');
                    return;
                }
                
                switchTab(tabId, btn);
            });
            
            console.log('页签切换功能已初始化（事件委托）');
        }
        
        // 页面加载时恢复数据
        function initPage() {
            restoreInterpretData();
            updateProjectInfoDisplay();
            renderFileList();
            // 延迟初始化页签，确保DOM完全渲染
            setTimeout(initTabSwitching, 50);
        }
        
        // 多种方式确保初始化
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initPage);
        } else {
            // DOM已经加载完成
            initPage();
        }
        
        // 也监听load事件作为备用
        window.addEventListener('load', function() {
            setTimeout(initTabSwitching, 100);
        });
        
        // 如果是在iframe中，也监听iframe的load事件
        if (window.frameElement) {
            window.frameElement.addEventListener('load', function() {
                setTimeout(initTabSwitching, 100);
            });
        }
        
        // 恢复解析数据
        function restoreInterpretData() {
            try {
                const saved = localStorage.getItem(STORAGE_INTERPRET_KEY);
                if (saved) {
                    const data = JSON.parse(saved);
                    if (data.projectInfo) {
                        projectInfo = { ...projectInfo, ...data.projectInfo };
                    }
                    if (data.uploadedFiles) {
                        uploadedFiles = data.uploadedFiles;
                    }
                    if (data.isParsing !== undefined) {
                        isParsing = data.isParsing;
                    }
                    if (data.parseCompleted !== undefined) {
                        parseCompleted = data.parseCompleted;
                    }
                }
            } catch (e) {
                console.error('恢复数据失败:', e);
            }
        }
        
        // 处理文件选择
        function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            if (files.length === 0) return;
            
            files.forEach(file => {
                // 验证文件类型
                const validExtensions = ['.doc', '.docx', '.pdf', '.xls', '.xlsx'];
                const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
                if (!validExtensions.includes(fileExtension)) {
                    showToast('不支持的文件类型：' + file.name, 'error');
                    return;
                }
                
                // 验证文件大小（40MB）
                if (file.size > 40 * 1024 * 1024) {
                    showToast('文件大小超过限制：' + file.name, 'error');
                    return;
                }
                
                // 检查是否已存在同名文件
                if (uploadedFiles.some(f => f.name === file.name)) {
                    showToast('文件已存在：' + file.name, 'warning');
                    return;
                }
                
                // 添加到文件列表
                uploadedFiles.push({
                    id: Date.now() + Math.random(),
                    name: file.name,
                    size: file.size,
                    status: 'uploaded', // uploaded, parsing, success, error
                    file: file
                });
            });
            
            // 清空input以便可以再次选择相同文件
            event.target.value = '';
            
            renderFileList();
            saveInterpretData();
        }
        
        // 渲染文件列表
        function renderFileList() {
            const fileList = document.getElementById('fileList');
            const startParseBtn = document.getElementById('startParseBtn');
            
            if (uploadedFiles.length === 0) {
                fileList.innerHTML = '';
                startParseBtn.disabled = true;
                startParseBtn.innerHTML = '<i class="fas fa-magic"></i><span>开始生成解析摘要</span>';
                return;
            }
            
            // 更新按钮状态
            const hasUnparsedFiles = uploadedFiles.some(f => f.status === 'uploaded');
            const hasParsingFiles = uploadedFiles.some(f => f.status === 'parsing');
            
            if (isParsing || hasParsingFiles) {
                startParseBtn.disabled = true;
                startParseBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>解析中...</span>';
            } else if (hasUnparsedFiles) {
                startParseBtn.disabled = false;
                startParseBtn.innerHTML = '<i class="fas fa-magic"></i><span>开始生成解析摘要</span>';
            } else {
                startParseBtn.disabled = true;
                startParseBtn.innerHTML = '<i class="fas fa-check-circle"></i><span>所有文件已解析</span>';
            }
            
            // 渲染文件列表
            fileList.innerHTML = uploadedFiles.map(file => {
                const fileSize = (file.size / 1024).toFixed(0) + ' KB';
                let statusHtml = '';
                
                if (file.status === 'uploaded') {
                    statusHtml = '<span class="text-gray-500 text-xs"><i class="fas fa-clock mr-1"></i>待解析</span>';
                } else if (file.status === 'parsing') {
                    statusHtml = '<span class="text-blue-600 text-xs"><i class="fas fa-spinner fa-spin mr-1"></i>解析中</span>';
                } else if (file.status === 'success') {
                    statusHtml = '<span class="text-green-600 text-xs"><i class="fas fa-check-circle mr-1"></i>成功</span>';
                } else if (file.status === 'error') {
                    statusHtml = '<span class="text-red-600 text-xs"><i class="fas fa-exclamation-circle mr-1"></i>失败</span>';
                }
                
                return `
                    <div class="flex items-center justify-between p-3 border border-gray-100 rounded-xl">
                        <div class="flex-1">
                            <p class="font-semibold text-gray-800">${file.name}</p>
                            <p class="text-xs text-gray-500">${fileSize}</p>
                        </div>
                        <div class="flex items-center gap-2">
                            ${statusHtml}
                            ${file.status === 'uploaded' || file.status === 'error' ? `
                                <button onclick="removeFile('${file.id}')" class="text-gray-400 hover:text-red-600 transition" title="删除">
                                    <i class="fas fa-times"></i>
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // 删除文件
        function removeFile(fileId) {
            // 将字符串ID转换为数字进行比较
            const id = typeof fileId === 'string' ? parseFloat(fileId) : fileId;
            uploadedFiles = uploadedFiles.filter(f => {
                const fileIdNum = typeof f.id === 'string' ? parseFloat(f.id) : f.id;
                return fileIdNum !== id;
            });
            renderFileList();
            saveInterpretData();
        }
        
        // 拖拽上传处理
        function handleDragOver(event) {
            event.preventDefault();
            event.stopPropagation();
            event.currentTarget.classList.add('border-blue-500', 'bg-blue-50');
        }
        
        function handleDragLeave(event) {
            event.preventDefault();
            event.stopPropagation();
            event.currentTarget.classList.remove('border-blue-500', 'bg-blue-50');
        }
        
        function handleFileDrop(event) {
            event.preventDefault();
            event.stopPropagation();
            event.currentTarget.classList.remove('border-blue-500', 'bg-blue-50');
            
            const files = Array.from(event.dataTransfer.files);
            if (files.length === 0) return;
            
            // 创建模拟的change事件
            const input = document.getElementById('fileInput');
            const dataTransfer = new DataTransfer();
            files.forEach(file => {
                // 验证文件类型
                const validExtensions = ['.doc', '.docx', '.pdf', '.xls', '.xlsx'];
                const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
                if (validExtensions.includes(fileExtension)) {
                    dataTransfer.items.add(file);
                }
            });
            
            input.files = dataTransfer.files;
            handleFileSelect({ target: input });
        }
        
        // 开始解析所有文件
        function startParseAll() {
            if (isParsing) return;
            
            const unparsedFiles = uploadedFiles.filter(f => f.status === 'uploaded');
            if (unparsedFiles.length === 0) {
                showToast('没有待解析的文件', 'warning');
                return;
            }
            
            isParsing = true;
            parseCompleted = false;
            
            // 更新所有待解析文件状态为解析中
            unparsedFiles.forEach(file => {
                file.status = 'parsing';
            });
            renderFileList();
            saveInterpretData();
            
            // 模拟解析过程（实际应该调用后端API）
            showToast('开始解析 ' + unparsedFiles.length + ' 个文件...', 'info');
            
            // 模拟异步解析
            let completedCount = 0;
            unparsedFiles.forEach((file, index) => {
                setTimeout(() => {
                    // 模拟解析成功或失败（90%成功率）
                    if (Math.random() > 0.1) {
                        file.status = 'success';
                        completedCount++;
                    } else {
                        file.status = 'error';
                        completedCount++;
                    }
                    
                    renderFileList();
                    saveInterpretData();
                    
                    // 所有文件解析完成
                    if (completedCount === unparsedFiles.length) {
                        isParsing = false;
                        const successCount = unparsedFiles.filter(f => f.status === 'success').length;
                        const errorCount = unparsedFiles.filter(f => f.status === 'error').length;
                        
                        if (errorCount === 0) {
                            parseCompleted = true;
                            showToast('所有文件解析完成！', 'success');
                            // 可以在这里触发解析摘要的生成
                            generateParseSummary();
                        } else {
                            showToast(`解析完成：${successCount} 个成功，${errorCount} 个失败`, successCount > 0 ? 'success' : 'error');
                        }
                    }
                }, (index + 1) * 1000 + Math.random() * 2000); // 模拟不同文件解析时间
            });
        }
        
        // 生成解析摘要（解析完成后调用）
        function generateParseSummary() {
            // 这里可以触发AI解析摘要的生成
            // 实际应该调用后端API生成摘要内容
            showToast('AI 解析摘要生成中...', 'info');
            
            // 模拟摘要生成完成
            setTimeout(() => {
                showToast('AI 解析摘要已生成', 'success');
                parseCompleted = true;
                saveInterpretData();
            }, 2000);
        }
        
        // 保存解析数据
        function saveInterpretData() {
            try {
                const data = {
                    projectInfo: projectInfo,
                    uploadedFiles: uploadedFiles.map(f => ({
                        id: f.id,
                        name: f.name,
                        size: f.size,
                        status: f.status
                        // 不保存file对象，因为无法序列化
                    })),
                    isParsing: isParsing,
                    parseCompleted: parseCompleted
                };
                localStorage.setItem(STORAGE_INTERPRET_KEY, JSON.stringify(data));
            } catch (e) {
                console.error('保存数据失败:', e);
            }
        }
        
        // 更新项目信息显示
        function updateProjectInfoDisplay() {
            document.getElementById('projectType').textContent = projectInfo.projectType;
            document.getElementById('projectName').textContent = projectInfo.projectName;
            document.getElementById('tenderer').textContent = projectInfo.tenderer;
            document.getElementById('agency').textContent = projectInfo.agency;
            
            if (projectInfo.bidDate) {
                const date = new Date(projectInfo.bidDate);
                document.getElementById('bidDate').textContent = date.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
            
            document.getElementById('validPeriod').textContent = projectInfo.validPeriod + '天';
        }
        
        // 编辑项目信息
        function editProjectInfo() {
            const viewDiv = document.getElementById('projectInfoView');
            const editDiv = document.getElementById('projectInfoEdit');
            const editBtn = document.getElementById('editProjectBtn');
            
            viewDiv.classList.add('hidden');
            editDiv.classList.remove('hidden');
            editBtn.classList.add('hidden');
            
            // 填充编辑表单
            document.getElementById('editProjectType').value = projectInfo.projectType;
            document.getElementById('editProjectName').value = projectInfo.projectName;
            document.getElementById('editTenderer').value = projectInfo.tenderer;
            document.getElementById('editAgency').value = projectInfo.agency || '';
            document.getElementById('editBidDate').value = projectInfo.bidDate ? projectInfo.bidDate.substring(0, 16) : '';
            document.getElementById('editValidPeriod').value = projectInfo.validPeriod || 90;
        }
        
        // 保存项目信息
        function saveProjectInfo() {
            projectInfo.projectType = document.getElementById('editProjectType').value;
            projectInfo.projectName = document.getElementById('editProjectName').value;
            projectInfo.tenderer = document.getElementById('editTenderer').value;
            projectInfo.agency = document.getElementById('editAgency').value;
            projectInfo.bidDate = document.getElementById('editBidDate').value + ':00';
            projectInfo.validPeriod = parseInt(document.getElementById('editValidPeriod').value) || 90;
            
            if (!projectInfo.projectName || !projectInfo.tenderer || !projectInfo.bidDate) {
                alert('请填写必填项：项目名称、招标人、开标日期');
                return;
            }
            
            updateProjectInfoDisplay();
            saveInterpretData();
            cancelEditProjectInfo();
            
            // 显示保存成功提示
            showToast('项目信息已保存', 'success');
        }
        
        // 取消编辑
        function cancelEditProjectInfo() {
            const viewDiv = document.getElementById('projectInfoView');
            const editDiv = document.getElementById('projectInfoEdit');
            const editBtn = document.getElementById('editProjectBtn');
            
            viewDiv.classList.remove('hidden');
            editDiv.classList.add('hidden');
            editBtn.classList.remove('hidden');
        }
        
        // Toast提示
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const bgColor = {
                'success': 'bg-green-500',
                'warning': 'bg-yellow-500',
                'error': 'bg-red-500',
                'info': 'bg-blue-500'
            }[type] || 'bg-blue-500';
            
            toast.className = `fixed top-4 right-4 ${bgColor} text-white px-4 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2`;
            toast.innerHTML = `<span>${message}</span>`;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transition = 'opacity 0.3s';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        function goToNextStep(page) {
            try {
                // 如果在标书制作.html的iframe中，需要切换步骤
                if (window.parent && window.parent !== window) {
                    // 检查是否在标书制作.html中
                    try {
                        // 先检查是否有switchStep函数（标书制作.html的特征）
                        if (typeof window.parent.switchStep === 'function') {
                            // 根据目标页面确定步骤
                            let stepId = null;
                            if (page === '标书设置.html') {
                                stepId = 'step2';
                            } else if (page === '标书编写.html') {
                                stepId = 'step3';
                            }
                            
                            if (stepId) {
                                // 直接调用父窗口的switchStep函数
                                window.parent.switchStep(stepId);
                                return;
                            }
                        }
                    } catch (e) {
                        // 跨域或其他错误，继续下面的逻辑
                        console.log('无法访问父窗口:', e);
                    }
                    
                    // 如果在index.html的iframe中，使用loadPage
                    if (window.parent.loadPage) {
                        window.parent.loadPage(page, 'step');
                        return;
                    }
                }
                // 如果没有parent或parent没有loadPage，直接跳转
                window.location.href = page;
            } catch (e) {
                console.error('跳转失败:', e);
                // 出错时直接跳转
                window.location.href = page;
            }
        }
        
        function goBack() {
            try {
                // 尝试返回到标书制作页面（如果在iframe中）
                if (window.parent && window.parent !== window) {
                    // 如果在标书制作页面的iframe中，返回到标书工厂
                    if (window.parent.loadPage) {
                        window.parent.loadPage('标书工厂.html', 'top');
                        return;
                    }
                }
                // 直接跳转到标书工厂
                window.location.href = '标书工厂.html';
            } catch (e) {
                console.error('返回失败:', e);
                window.location.href = '标书工厂.html';
            }
        }
        

        // 包级页签交互（多包场景示例）
        function initPackageTabs() {
            const packageNames = {
                pkg1: '包一 · 平台建设',
                pkg2: '包二 · 运维服务',
                pkg3: '包三 · 备选方案'
            };

            const pkgTabs = document.querySelectorAll('.pkg-tab');
            const currentPackageLabel = document.getElementById('currentPackageLabel');

            if (pkgTabs.length === 0) return;

            pkgTabs.forEach(btn => {
                btn.addEventListener('click', function () {
                    const pkgId = this.getAttribute('data-pkg');

                    // 切换包级 tab 的选中样式
                    pkgTabs.forEach(b => {
                        b.classList.remove('active', 'bg-blue-50', 'text-blue-600', 'font-medium');
                        b.classList.add('bg-gray-50', 'text-gray-500');
                    });
                    this.classList.add('active', 'bg-blue-50', 'text-blue-600', 'font-medium');
                    this.classList.remove('bg-gray-50', 'text-gray-500');

                    // 更新当前包展示文案（实际接入时可切换为对应包的解析数据）
                    if (currentPackageLabel && packageNames[pkgId]) {
                        currentPackageLabel.textContent = '当前包：' + packageNames[pkgId];
                    }
                });
            });
        }
        
        // 初始化包级页签
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                initPackageTabs();
            });
        } else {
            initPackageTabs();
        }
        
        window.addEventListener('load', function() {
            initPackageTabs();
        });
    </script>
</body>
</html>

